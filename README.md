# 糖豆视频下载器

[糖豆](https://www.tangdoucdn.com/)视频都是以URL的参数`vid`作为引索，可以通过`vid`获得想要的视频。原始视频链接的获取有HTML解析与API接口请求两种方式。

# HTML解析

通过访问视频链接，通过GET方法获得响应体，响应体为HTML文档，对其进行解析寻找`video`标签便可获得视频原始连接。但若直接访问`www.tangdoucdn.com/h5/play?vid=`是无法找到`video`标签的，而是要访问`share.tangdou.com/splay.php?vid=`才可以。

# API接口请求

上面所说的访问`www.tangdoucdn.com/h5/play?vid=`无法找到`video`标签，是因为这个连接下的页面中的`video`标签是动态生成的，而其生成的方式正式通过访问它的API接口获取的原始视频链接，接口地址为`api-h5.tangdou.com/sample/share/main?vid=`。该接口返回一个JSON格式数据，对该数据进行解析后`data`属性下的`video_url`的值正是原始视频链接，`title`属性的值则为使用Unicode编码的视频名称，但要想从此接口正常获取数据需提供请求标头如下：
```
Accept: application/json, text/plain, */*
Accept-Encoding: gzip, deflate, br
Accept-Language: zh,zh-CN;q=0.9
Connection: keep-alive
Host: api-h5.tangdou.com
Referer: https://www.tangdoucdn.com/
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/101.0.4951.54 Safari/537.36
```
由于使用API接口更加统一，故此下载器使用API接口的方式获取原始视频链接。
原始JSON数据如下：
```
{
    "code":0,
    "msg":"td_e6e91cdfd15708590dc38fae5b1ae5f6",
    "data":{
        "share_jump_share":0,
        "ad_h5share":"ad_h5share-old",
        "ab_list":{
            "dancing":"dancing-new",
            "search_resultpage_tab":"search_resultpage_tab-new",
            "high_definition_down":"high_definition_down-new",
            "newuser_interest_label2":"newuser_interest_label2-old",
            "newuser_test":"newuser_test-new",
            "mypage_down_module":"mypage_down_module-old",
            "search_page_video_tag":"search_page_video_tag-new",
            "vip_buy_name":"vip_buy_name-new",
            "h5_copywriting":"h5_copywriting-new",
            "newuser_masking":"newuser_masking-old",
            "followdance_guess":"followdance_guess-new",
            "login_optimize":"login_optimize-new",
            "adtest_plaque":"adtest_plaque-old",
            "favpage_add_feed":"favpage_add_feed-new",
            "relatedad_cancel7days_newuser":"relatedad_cancel7days_newuser-old",
            "h5_behavior_button":"h5_behavior_button-new",
            "rec_reason_feed":"rec_reason_feed-new",
            "followdance_mirror_lead":"followdance_mirror_lead-old",
            "app_record_oritation":"app_record_oritation-off",
            "video_rank_split":"video_rank_split-old",
            "newuser_playpage_circle":"newuser_playpage_circle-old_equal",
            "downpage_circle_name":"downpage_circle_name-old",
            "download_ad_tail":"download_ad_tail-new",
            "download_list_rank":"download_list_rank-old",
            "search_daren_icon":"search_daren_icon-old",
            "followdance_button":"followdance_button-new",
            "feed_intromit_video":"feed_intromit_video-old",
            "video_result_rank":"video_result_rank-old",
            "followdance_practice_rank":"followdance_practice_rank-old",
            "newuser_video_lead":"newuser_video_lead-old",
            "dance_feed_ad":"dance_feed_ad-new",
            "downpage_hide_send_old":"downpage_hide_send_old-old",
            "newuser_video_lead2":"newuser_video_lead2-old",
            "playpage_add_headad_newuser":"playpage_add_headad_newuser-new",
            "app_smalltv_ab":"app_smalltv_ab-new",
            "followdance_newuser_lead_new":"followdance_newuser_lead_new-new_1",
            "feed_rank_tab":"feed_rank_tab-old",
            "followdance_gif":"followdance_gif-new",
            "athome_banner":"athome_banner-old",
            "play_endpage_video":"play_endpage_video-old",
            "vip_intro":"vip_intro-new",
            "followdance_listpage_tag":"followdance_listpage_tag-old_equal",
            "head_regional":"head_regional-new",
            "keep_alive":"keep_alive-old",
            "followdance_tab_fit":"followdance_tab_fit-old",
            "icon_red_dot":"icon_red_dot-new",
            "followdance_preview":"followdance_preview-old",
            "followdance_ending":"followdance_ending-new",
            "followdance_category_fit_ex2":"followdance_category_fit_ex2-old",
            "followdance_category_fit_ex1":"followdance_category_fit_ex1-old",
            "video_tag1":"video_tag1-new1",
            "ad_h5share":"ad_h5share-old",
            "h5_head_block":"h5_head_block-old",
            "video_tag2":"video_tag2-new",
            "searchresult_page_ad":"searchresult_page_ad-old",
            "h5_bangdan":"h5_bangdan-old",
            "feed_add_module1":"feed_add_module1-old",
            "feed_add_module2":"feed_add_module2-old",
            "newuser_feed_simple_new":"newuser_feed_simple_new-old",
            "followdance_practice_button":"followdance_practice_button-old",
            "feed_add_module3":"feed_add_module3-old",
            "dance_mirror":"dance_mirror-old",
            "rec_reason_related":"rec_reason_related-new",
            "downpage_video_fold":"downpage_video_fold-old",
            "endpage_auto_play":"endpage_auto_play-old",
            "followdance_screen_message":"followdance_screen_message-old",
            "download_next_button":"download_next_button-new",
            "followdance_end_form":"followdance_end_form-old",
            "search_middlepage_history":"search_middlepage_history-old",
            "followdance_voice_lead":"followdance_voice_lead-old",
            "follow_page_frame":"follow_page_frame-new",
            "followdance_all_new_user_ex2":"followdance_all_new_user_ex2-old",
            "followdance_character":"followdance_character-old",
            "playpage_ad_turn":"playpage_ad_turn-old",
            "followdance_newuser_leader":"followdance_newuser_leader-old",
            "dance_rest_ad":"dance_rest_ad-old",
            "search_entrance":"search_entrance-old",
            "h5_tail_bar":"h5_tail_bar-new2",
            "followpage_live":"followpage_live-old",
            "newuser_interest_label":"newuser_interest_label-new2",
            "followdance_playpage_ex1":"followdance_playpage_ex1-old",
            "search_middle_page_banner":"search_middle_page_banner-old",
            "member_block":"member_block-new2",
            "followdance_all_new_user":"followdance_all_new_user-old",
            "downpage_hide_send_new":"downpage_hide_send_new-new1",
            "ad_share_feed":"ad_share_feed-old_equal",
            "vip_video_section":"vip_video_section-new",
            "default_followdance_tab":"default_followdance_tab-old",
            "feed_insert_ad":"feed_insert_ad-old",
            "download_play_optimize":"download_play_optimize-old",
            "newuser_nosend_diu":"newuser_nosend_diu-old",
            "download_page_optimize":"download_page_optimize-old",
            "video_rank":"video_rank-old",
            "followdance_screen_message_lead":"followdance_screen_message_lead-old",
            "feed_insert_video":"feed_insert_video-old",
            "download_video_cache":"download_video_cache-new",
            "pause_ad":"pause_ad-new",
            "download_split_tab":"download_split_tab-new",
            "feed_daren_icon":"feed_daren_icon-old",
            "followdance_timetag":"followdance_timetag-old",
            "followdance_fullscreen":"followdance_fullscreen-old",
            "dance_quitted_ad":"dance_quitted_ad-old",
            "followdance_playpage_ex2":"followdance_playpage_ex2-old",
            "app_log_switch":"app_log_switch-off",
            "cold_boot_newuser":"cold_boot_newuser-old",
            "dance_bubble_ad":"dance_bubble_ad-old",
            "newuser_feed_button":"newuser_feed_button-old",
            "playpage_circle":"playpage_circle-new2",
            "noplay_user_lead":"noplay_user_lead-new3",
            "tab_icon":"tab_icon-old_3",
            "followdance_share_optim":"followdance_share_optim-new_1",
            "playpage_add_headad_olduser":"playpage_add_headad_olduser-new",
            "download_dance_play":"download_dance_play-old",
            "followdance_video_gif":"followdance_video_gif-old",
            "third_system_ad":"third_system_ad-old",
            "feed_adtag":"feed_adtag-old",
            "homepage_tab":"homepage_tab-old",
            "followdance_searchmid_fit":"followdance_searchmid_fit-old",
            "h5_end_block":"h5_end_block-old",
            "visitor_vip":"visitor_vip-new2",
            "downfav_relate_lead":"downfav_relate_lead-old",
            "searchkey_external_newuser":"searchkey_external_newuser-old",
            "h5_bar":"h5_bar-new2",
            "top_search":"top_search-new",
            "homepage_history_button":"homepage_history_button-old",
            "feed_form":"feed_form-old",
            "feed_ad_position":"feed_ad_position-new",
            "feed_video_tag":"feed_video_tag-new",
            "dance_pause_ad":"dance_pause_ad-new",
            "followdance_commend":"followdance_commend-old",
            "ad_share_top":"ad_share_top-old",
            "followdance_practice_plan":"followdance_practice_plan-old",
            "h5_bar_relatedvideo":"h5_bar_relatedvideo-old",
            "vip_buy_template":"vip_buy_template-new",
            "followdance_video_form_new":"followdance_video_form_new-old",
            "downpage_feed":"downpage_feed-new",
            "play_page_multi_head_ad":"play_page_multi_head_ad-new1",
            "keeplive":"keeplive-2",
            "historypage_add_feed":"historypage_add_feed-new",
            "guanfang":"guanfang-new",
            "recommend_revision":"recommend_revision-old",
            "pause_ad_ui":"pause_ad_ui-old",
            "quit_pop_ad_new":"quit_pop_ad_new-old",
            "dance_quiting_ad":"dance_quiting_ad-new",
            "vip_video_dv":"vip_video_dv-old_equal",
            "playad_noheadad_v3":"playad_noheadad_v3-old",
            "ad_share_top_new":"ad_share_top_new-new_grey",
            "h5_head_bar_red":"h5_head_bar_red-old",
            "h5_head":"h5_head-new",
            "playpage_ad_type":"playpage_ad_type-old",
            "audio_player":"audio_player-new",
            "h5_middle_block":"h5_middle_block-new",
            "followdance_dance_game":"followdance_dance_game-old",
            "followdance_guess_video":"followdance_guess_video-old",
            "h5_video_click":"h5_video_click-new",
            "mp3_video_rank":"mp3_video_rank-new",
            "tab_athome":"tab_athome-new",
            "downpage_pause_ad":"downpage_pause_ad-new",
            "related_play_button":"related_play_button-new",
            "followdance_rank_entrance":"followdance_rank_entrance-old",
            "feedui_optimize":"feedui_optimize-old",
            "feed_video_comment":"feed_video_comment-old",
            "followdance_frontpage_fit":"followdance_frontpage_fit-old",
            "followdance_start_button":"followdance_start_button-new_2",
            "search_play_button":"search_play_button-new",
            "download_video_ad":"download_video_ad-old",
            "push_optimize_newuser":"push_optimize_newuser-old",
            "quick_login":"quick_login-new",
            "playpage_plaque_ad":"playpage_plaque_ad-old",
            "mypage_ui":"mypage_ui-new",
            "vip_video":"vip_video-old_equal",
            "jump_home_list_ab1":"jump_home_list_ab1-old",
            "followdance_video_content":"followdance_video_content-old_equal",
            "quit_pop_ad":"quit_pop_ad-old",
            "ad_share_feed_new":"ad_share_feed_new-old_equal",
            "playpage_insert_ad":"playpage_insert_ad-old",
            "h5_roll_button":"h5_roll_button-old",
            "download_ad_head":"download_ad_head-new",
            "followdance_strength_toptab":"followdance_strength_toptab-new",
            "followdance_tab_newdic":"followdance_tab_newdic-old",
            "relatedad_cancel_newuser":"relatedad_cancel_newuser-new",
            "main_classification_newuser":"main_classification_newuser-old",
            "h5_more_button":"h5_more_button-old",
            "followdance_dangcing_pk":"followdance_dangcing_pk-old_equal",
            "play_page_live":"play_page_live-old",
            "followdance_perspective":"followdance_perspective-old",
            "home_download":"home_download-new2",
            "followdance_dancing_lead":"followdance_dancing_lead-old",
            "followdance_tab_channel":"followdance_tab_channel-old",
            "search_page_survey":"search_page_survey-old",
            "followdance_hotest_lastest":"followdance_hotest_lastest-old",
            "ad_wm_preload":"ad_wm_preload-new"
        },
        "title":"\u96e8\u51e1\u300a\u75af\u75af\u75af\u300b64\u6b65\u5f39\u8df3\u9644\u5206\u89e3",
        "video_url":"https:\/\/aqiniushare.tangdou.com\/202202\/20000001680857_H540P.mp4?sign=ad827549b398201f20803ffc3ab6b688&t=6278ff27",
        "hits_total":"10.2\u4e07",
        "good_total":661,
        "type":1003003,
        "pic":"https:\/\/bimg.tangdou.com\/public\/tangdouhao\/2022\/0222\/58181B33ABBE33B01A9CD09FF9006B08.jpg",
        "play_url":"https:\/\/aqiniushare.tangdou.com\/202202\/20000001680857_H540P.mp4?sign=ad827549b398201f20803ffc3ab6b688&t=6278ff27",
        "duration":"640",
        "comment_num":0,
        "head_t":"6",
        "end_t":"3.19",
        "uid":10074,
        "user_name":"\u96e8\u51e1\u5e7f\u573a\u821e",
        "user_avatar":"https:\/\/bimg.tangdou.com\/public\/avatar\/2020\/0925\/v10074-1601023469.jpg!small",
        "open_app_fail":0,
        "item_info":[

        ],
        "status":0,
        "message":"\u62b1\u6b49\uff0c\u6ca1\u6709\u627e\u5230\u76f8\u5173\u89c6\u9891",
        "mp3_tag_name":"",
        "share_off":"1",
        "play_percent":"10",
        "is_topic_vid":0,
        "is_vip_video":0
    }
}
```